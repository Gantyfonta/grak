<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Grak the Caveman</title>
  <style>
    body { font-family: sans-serif; background:#222; color:#eee; display:flex; flex-direction:column; height:100vh; margin:0; }
    #chat { flex:1; padding:10px; overflow-y:auto; }
    .msg { margin:5px 0; padding:6px 10px; border-radius:6px; max-width:70%; }
    .user { background:#444; margin-left:auto; }
    .grak { background:#333; margin-right:auto; }
    #inputArea { display:flex; padding:10px; background:#111; }
    #input { flex:1; padding:8px; border:none; border-radius:4px; }
    button { padding:8px 12px; margin-left:8px; background:#555; color:#fff; border:none; border-radius:4px; cursor:pointer; }
    button:hover { background:#666; }
  </style>
</head>
<body>
  <div id="chat"><div class="msg grak">Grak say: Me awake. Ugh!</div></div>
  <div id="inputArea">
    <input id="input" placeholder="Say something to Grak...">
    <button onclick="send()">Send</button>
  </div>

<script type="module">
import { pipeline } from "https://cdn.jsdelivr.net/npm/@xenova/transformers";

let chat = document.getElementById("chat");
let input = document.getElementById("input");
let sendButton = document.querySelector("button");

chat.innerHTML += `<div class="msg grak">Loading Grak brain... wait...</div>`;
sendButton.disabled = true;
input.disabled = true;

async function initGrak() {
  const generator = await pipeline("text-generation", "Xenova/gpt2-tiny"); // much smaller, faster

  function cavemanize(text) {
    return "Grak say: " + text
      .replace(/\bI am\b/gi, "me")
      .replace(/\bmy\b/gi, "Grakâ€™s")
      .replace(/\byou\b/gi, "u")
      .replace(/\bare\b/gi, "is")
      .replace(/\bthe\b/gi, "")
      .replace(/[.,!?]/g, "") + " Ugh!";
  }

  window.send = async function() {
    let userText = input.value.trim();
    if (!userText) return;
    input.value = "";

    chat.innerHTML += `<div class="msg user">You: ${userText}</div>`;

    let output = await generator(userText, { max_new_tokens: 25 });
    let rawReply = output[0].generated_text.replace(userText, "").trim();

    // fallback if model babbles too much
    if (!rawReply) rawReply = "me grunt";

    let reply = cavemanize(rawReply);
    chat.innerHTML += `<div class="msg grak">${reply}</div>`;
    chat.scrollTop = chat.scrollHeight;
  };

  chat.innerHTML += `<div class="msg grak">Grak ready! Talk now.</div>`;
  sendButton.disabled = false;
  input.disabled = false;
}

initGrak();
</script>
</body>
</html>
