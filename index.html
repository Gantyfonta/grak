<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Grak the Caveman ‚Äî Free AI</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  body { margin:0; background:#111; color:#eee; font-family:system-ui, sans-serif; display:flex; min-height:100vh; }
  .app { max-width:800px; margin:auto; padding:16px; width:100%; display:flex; flex-direction:column; gap:12px; }
  h1 { margin:0; font-size:1.4rem; opacity:.9; }
  #chat { flex:1; min-height:50vh; background:#0b0b0b; border:1px solid #222; border-radius:12px; padding:12px; overflow-y:auto; }
  .msg { margin:.5rem 0; max-width:75%; padding:.6rem .8rem; border-radius:10px; line-height:1.35; }
  .you { background:#1f2937; margin-left:auto; }
  .grak { background:#1a1a1a; border:1px solid #262626; }
  .sys { color:#bbb; font-style:italic; }
  .row { display:flex; gap:8px; }
  input, button, select { background:#1a1a1a; color:#eee; border:1px solid #333; border-radius:10px; padding:.7rem .8rem; }
  input { flex:1; }
  button { cursor:pointer; }
  button:disabled { opacity:.5; cursor:not-allowed; }
</style>
</head>
<body>
  <div class="app">
    <h1>üí¨ Talk to <strong>Grak</strong> (caveman AI)</h1>
    <div id="chat">
      <div class="msg grak">Grak say: Me awake. Ugh!</div>
      <div class="msg sys">Loading brain‚Ä¶ first time may take a bit.</div>
    </div>
    <div class="row">
      <input id="input" placeholder="Ask Grak anything‚Ä¶" disabled />
      <button id="sendBtn" disabled>Send</button>
    </div>
    <div class="row sys">Model: distilgpt2 (can switch to gpt2-tiny for speed)</div>
  </div>

<script type="module">
import { pipeline } from "https://cdn.jsdelivr.net/npm/@xenova/transformers@2.9.0";

const chat = document.getElementById("chat");
const input = document.getElementById("input");
const sendBtn = document.getElementById("sendBtn");

let generator = null;

// helpers
function addMsg(text, who="grak") {
  const div = document.createElement("div");
  div.className = "msg " + (who==="you"?"you":who==="sys"?"sys":"grak");
  div.textContent = (who==="you" ? "You: " : who==="grak" ? "Grak: " : "") + text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}
function setReady(r) { input.disabled = !r; sendBtn.disabled = !r; }

// caveman style
function cavemanize(raw) {
  if(!raw) raw="me grunt";
  raw = raw.replace(/(?:^|\s)(grak:?\s*){2,}/gi," ").replace(/\s+/g," ").trim();
  const maxWords=28;
  let words=raw.split(" ").slice(0,maxWords).join(" ");
  words=words.replace(/\bI am\b/gi,"me").replace(/\bI'm\b/gi,"me").replace(/\bmy\b/gi,"Grak‚Äôs")
             .replace(/\byou\b/gi,"u").replace(/\byour\b/gi,"u").replace(/\bare\b/gi,"is")
             .replace(/\bthe\b/gi,"").replace(/[‚Äú‚Äù"']/g,"").replace(/\s([,.;!?])/g,"$1");
  if(!/ugh!?$/i.test(words)) words+=" Ugh!";
  return words;
}

// load model
async function loadModel() {
  setReady(false);
  addMsg("Grak sharpening rock‚Ä¶", "sys");
  generator = await pipeline("text-generation","Xenova/distilgpt2");
  addMsg("Grak brain ready.", "sys");
  setReady(true);
}

// grak answers
async function grakAnswer(q) {
  if(!generator) await loadModel();
  const prompt = `
You are Grak, a caveman. Answer questions clearly and directly, in short caveman sentences. Never wander off-topic. Examples:
Human: What is fire?
Grak: Fire hot. Grak use to cook. Ugh!
Human: Who is Einstein?
Grak: Smart man. He learn stars and numbers. Ugh!
Human: ${q}
Grak:`;
  const out = await generator(prompt, {max_new_tokens:40,temperature:0.7,top_p:0.9,repetition_penalty:1.2});
  let raw = out?.[0]?.generated_text?.replace(prompt,"").trim() || "me grunt";
  raw = raw.split(/\n|(?<=[.!?])\s/)[0];
  return cavemanize(raw);
}

// send
async function send() {
  const text=input.value.trim(); if(!text) return;
  addMsg(text,"you"); input.value="";
  const thinking = document.createElement("div"); thinking.className="msg grak sys"; thinking.textContent="Grak thinking‚Ä¶";
  chat.appendChild(thinking); chat.scrollTop=chat.scrollHeight;
  try {
    const reply=await grakAnswer(text);
    thinking.remove();
    addMsg(reply,"grak");
  } catch(e) { thinking.remove(); addMsg("Grak head hurt. Try simple words.", "grak"); console.error(e); }
}

sendBtn.addEventListener("click",send);
input.addEventListener("keydown",e=>{if(e.key==="Enter") send();});

loadModel();
</script>
</body>
</html>
